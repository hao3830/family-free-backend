
CREATE DATABASE IF NOT EXISTS se_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

USE se_db;

SET NAMES utf8mb4;
SET CHARACTER SET utf8mb4;

CREATE TABLE IF NOT EXISTS QUEQUAN (
    ID INT AUTO_INCREMENT,

    MAQUEQUAN VARCHAR(50),
    TENQUANHE VARCHAR(50) NOT NULL,

    PRIMARY KEY (ID),
    UNIQUE (MAQUEQUAN)
);

DELIMITER //

CREATE TRIGGER gen_MAQUEQUAN
BEFORE INSERT ON QUEQUAN
FOR EACH ROW
BEGIN
    DECLARE last_id INT;
    SET last_id = (SELECT COALESCE(MAX(ID), 0) FROM QUEQUAN);
    SET NEW.MAQUEQUAN = CONCAT('QQ', LPAD(last_id + 1, 3, '0'));
END //

DELIMITER ;

CREATE TABLE IF NOT EXISTS NGHENGHIEP (
    ID INT AUTO_INCREMENT,

    MANGHENGHIEP VARCHAR(50) ,
    TENNGHENGHIEP VARCHAR(50) NOT NULL,

    -- PRIMARY KEY (MANGHENGHIEP)
    PRIMARY KEY (ID),
    UNIQUE (MANGHENGHIEP)
);

DELIMITER //

CREATE TRIGGER gen_MANGHENGHIEP
BEFORE INSERT ON NGHENGHIEP
FOR EACH ROW
BEGIN
    DECLARE last_id INT;
    SET last_id = (SELECT COALESCE(MAX(ID), 0) FROM NGHENGHIEP);
    SET NEW.MANGHENGHIEP = CONCAT('NN', LPAD(last_id + 1, 3, '0'));
END //

DELIMITER ;

CREATE TABLE IF NOT EXISTS QUANHE (
    ID INT AUTO_INCREMENT,

    MALOAIQUANHE VARCHAR(50),
    TENLOAIQUANHE VARCHAR(50) NOT NULL,

    -- PRIMARY KEY (MALOAIQUANHE)
    PRIMARY KEY (ID),
    UNIQUE (MALOAIQUANHE)
);

DELIMITER //

CREATE TRIGGER gen_MAMALOAIQUANHE
BEFORE INSERT ON QUANHE
FOR EACH ROW
BEGIN
    DECLARE last_id INT;
    SET last_id = (SELECT COALESCE(MAX(ID), 0) FROM QUANHE);
    SET NEW.MALOAIQUANHE = CONCAT('QH', LPAD(last_id + 1, 3, '0'));
END //

DELIMITER ;

CREATE TABLE IF NOT EXISTS THANHVIEN (
    ID INT AUTO_INCREMENT,
    MATHANHVIEN VARCHAR(50),
    HOVATEN VARCHAR(50) NOT NULL,
    GIOITINH INT NOT NULL,
    NGAYGIOSINH DATETIME NOT NULL,
    MAQUEQUAN VARCHAR(50) NOT NULL,
    MANGHENGHIEP VARCHAR(50) NOT NULL,
    DIACHI VARCHAR(100) NOT NULL,
    MATHANHVIENCU VARCHAR(50),
    MALOAIQUANHE VARCHAR(50),
    NGAYPHATSINH DATETIME NOT NULL,
    THEHE INT NOT NULL,

    PRIMARY KEY (ID),
    UNIQUE (MATHANHVIEN),

    FOREIGN KEY (MAQUEQUAN) REFERENCES QUEQUAN(MAQUEQUAN),
    FOREIGN KEY (MANGHENGHIEP) REFERENCES NGHENGHIEP(MANGHENGHIEP),
    FOREIGN KEY (MALOAIQUANHE) REFERENCES QUANHE(MALOAIQUANHE)
);

DELIMITER //

CREATE TRIGGER gen_MATHANHVIEN
BEFORE INSERT ON THANHVIEN
FOR EACH ROW
BEGIN
    DECLARE last_id INT;
    SET last_id = (SELECT COALESCE(MAX(ID), 0) FROM THANHVIEN);
    SET NEW.MATHANHVIEN = CONCAT('TV', LPAD(last_id + 1, 3, '0'));
END //

DELIMITER ;



CREATE TABLE IF NOT EXISTS BAOCAOTANGGIAM (
    ID INT AUTO_INCREMENT,

    MABAOCAOTANGGIAM VARCHAR(50),
    NAM INT NOT NULL,
    SOLUONGSINH INT NOT NULL,
    SOLUONKETHON INT NOT NULL,
    SOLUONGMAT INT NOT NULL,

     PRIMARY KEY (ID),
    UNIQUE (MABAOCAOTANGGIAM)

);

DELIMITER //

CREATE TRIGGER gen_MABAOCAOTANGGIAM
BEFORE INSERT ON BAOCAOTANGGIAM
FOR EACH ROW
BEGIN
    DECLARE last_id INT;
    SET last_id = (SELECT COALESCE(MAX(ID), 0) FROM BAOCAOTANGGIAM);
    SET NEW.MABAOCAOTANGGIAM = CONCAT('BCTG', LPAD(last_id + 1, 3, '0'));
END //

DELIMITER ;

CREATE TABLE IF NOT EXISTS NGUYENNHAN (
    ID INT AUTO_INCREMENT,

    MANGUYENNHAN VARCHAR(50),
    TENNGUYENNHAN VARCHAR(50) NOT NULL,
     PRIMARY KEY (ID),

    UNIQUE(MANGUYENNHAN)
);

DELIMITER //

CREATE TRIGGER gen_MANGUYENNHAN
BEFORE INSERT ON NGUYENNHAN
FOR EACH ROW
BEGIN
    DECLARE last_id INT;
    SET last_id = (SELECT COALESCE(MAX(ID), 0) FROM NGUYENNHAN);
    SET NEW.MANGUYENNHAN = CONCAT('NNh', LPAD(last_id + 1, 3, '0'));
END //

DELIMITER ;

CREATE TABLE IF NOT EXISTS DIADIEMMAITANG (
    ID INT AUTO_INCREMENT,

    MADIADIEMMAITANG VARCHAR(50),
    TENDIADIEMMAITANG VARCHAR(50) NOT NULL,
     PRIMARY KEY (ID),

    UNIQUE(MADIADIEMMAITANG)
);

DELIMITER //

CREATE TRIGGER gen_MADIADIEMMAITANG
BEFORE INSERT ON DIADIEMMAITANG
FOR EACH ROW
BEGIN
    DECLARE last_id INT;
    SET last_id = (SELECT COALESCE(MAX(ID), 0) FROM DIADIEMMAITANG);
    SET NEW.MADIADIEMMAITANG = CONCAT('DDMT', LPAD(last_id + 1, 3, '0'));
END //

DELIMITER ;


CREATE TABLE IF NOT EXISTS KETTHUC (
    ID INT AUTO_INCREMENT,

    MAKETTHUC VARCHAR(50) ,
    HOVATEN VARCHAR(50) NOT NULL,
    NGAYGIOMAT DATETIME  NOT NULL,
    MANGUYENNHAN VARCHAR(50) NOT NULL,
    MADIADIEMMAITANG VARCHAR(50) NOT NULL,
    MATHANHVIEN VARCHAR(50) NOT NULL,

     PRIMARY KEY (ID),

    UNIQUE(MAKETTHUC),
    FOREIGN KEY (MANGUYENNHAN) REFERENCES NGUYENNHAN(MANGUYENNHAN),
    FOREIGN KEY (MADIADIEMMAITANG) REFERENCES DIADIEMMAITANG(MADIADIEMMAITANG),
    FOREIGN KEY (MATHANHVIEN) REFERENCES THANHVIEN(MATHANHVIEN)
);

DELIMITER //

CREATE TRIGGER gen_MAKETTHUC
BEFORE INSERT ON KETTHUC
FOR EACH ROW
BEGIN
    DECLARE last_id INT;
    SET last_id = (SELECT COALESCE(MAX(ID), 0) FROM KETTHUC);
    SET NEW.MAKETTHUC = CONCAT('KT', LPAD(last_id + 1, 3, '0'));
END //

DELIMITER ;

CREATE TABLE IF NOT EXISTS LOAITHANHTICH (
    ID INT AUTO_INCREMENT,

    MALOAITHANHTICH VARCHAR(50),
    TENLOAITHANHTICH VARCHAR(50) NOT NULL,

    PRIMARY KEY(ID),
    UNIQUE(MALOAITHANHTICH)

);

DELIMITER //

CREATE TRIGGER gen_MALOAITHANHTICH
BEFORE INSERT ON LOAITHANHTICH
FOR EACH ROW
BEGIN
    DECLARE last_id INT;
    SET last_id = (SELECT COALESCE(MAX(ID), 0) FROM LOAITHANHTICH);
    SET NEW.MALOAITHANHTICH = CONCAT('LTT', LPAD(last_id + 1, 3, '0'));
END //

DELIMITER ;

CREATE TABLE IF NOT EXISTS BAOCAOTHANHTICH (
    ID INT AUTO_INCREMENT,

    MABAOCAOTHANHTICH VARCHAR(50),
    NAM INT NOT NULL,
    MALOAITHANHTICH VARCHAR(50) NOT NULL,
    SOLUONGTHANHTICH INT NOT NULL,

    PRIMARY KEY(ID),
    UNIQUE(MABAOCAOTHANHTICH),
    FOREIGN KEY (MALOAITHANHTICH) REFERENCES LOAITHANHTICH(MALOAITHANHTICH)

);

DELIMITER //

CREATE TRIGGER gen_MABAOCAOTHANHTICH
BEFORE INSERT ON BAOCAOTHANHTICH
FOR EACH ROW
BEGIN
    DECLARE last_id INT;
    SET last_id = (SELECT COALESCE(MAX(ID), 0) FROM BAOCAOTHANHTICH);
    SET NEW.MABAOCAOTHANHTICH = CONCAT('BCTT', LPAD(last_id + 1, 3, '0'));
END //

DELIMITER ;


CREATE TABLE IF NOT EXISTS THANHTICH (
    ID INT AUTO_INCREMENT,

    MATHANHTICH VARCHAR(50),
    HOVATEN VARCHAR(50) NOT NULL,
    MALOAITHANHTICH VARCHAR(50) NOT NULL,
    NGAYPHATSINH DATETIME  NOT NULL,
    MATHANHVIEN VARCHAR(50) NOT NULL,

    PRIMARY KEY(ID),

    UNIQUE(MATHANHTICH),
    FOREIGN KEY (MALOAITHANHTICH) REFERENCES LOAITHANHTICH(MALOAITHANHTICH),
    FOREIGN KEY (MATHANHVIEN) REFERENCES THANHVIEN(MATHANHVIEN)

);

DELIMITER //

CREATE TRIGGER gen_MATHANHTICH
BEFORE INSERT ON THANHTICH
FOR EACH ROW
BEGIN
    DECLARE last_id INT;
    SET last_id = (SELECT COALESCE(MAX(ID), 0) FROM THANHTICH);
    SET NEW.MATHANHTICH = CONCAT('TT', LPAD(last_id + 1, 3, '0'));
END //

DELIMITER ;



INSERT INTO QUEQUAN(MAQUEQUAN, TENQUANHE) VALUES('QQ001', 'TP.HCM');
INSERT INTO QUEQUAN(MAQUEQUAN, TENQUANHE) VALUES('QQ002', 'Hà Nội');
INSERT INTO QUEQUAN(MAQUEQUAN, TENQUANHE) VALUES('QQ003', 'Đà Nẵng');
INSERT INTO QUEQUAN(MAQUEQUAN, TENQUANHE) VALUES('QQ004', 'Quảng Ngãi');
INSERT INTO QUEQUAN(MAQUEQUAN, TENQUANHE) VALUES('QQ005', 'Quảng Nam');
INSERT INTO QUEQUAN(MAQUEQUAN, TENQUANHE) VALUES('QQ006', 'Huế');
INSERT INTO QUEQUAN(MAQUEQUAN, TENQUANHE) VALUES('QQ007', 'Bình Định');


INSERT INTO NGHENGHIEP(MANGHENGHIEP, TENNGHENGHIEP) VALUES('NN001', 'Kỹ sư');
INSERT INTO NGHENGHIEP(MANGHENGHIEP, TENNGHENGHIEP) VALUES('NN002', 'Bác sĩ');
INSERT INTO NGHENGHIEP(MANGHENGHIEP, TENNGHENGHIEP) VALUES('NN003', 'Nông dân');
INSERT INTO NGHENGHIEP(MANGHENGHIEP, TENNGHENGHIEP) VALUES('NN004', 'Kiến trúc sư');
INSERT INTO NGHENGHIEP(MANGHENGHIEP, TENNGHENGHIEP) VALUES('NN005', 'Ca sĩ');
INSERT INTO NGHENGHIEP(MANGHENGHIEP, TENNGHENGHIEP) VALUES('NN006', 'Họa sĩ');
INSERT INTO NGHENGHIEP(MANGHENGHIEP, TENNGHENGHIEP) VALUES('NN007', 'CS-er');
INSERT INTO NGHENGHIEP(MANGHENGHIEP, TENNGHENGHIEP) VALUES('NN008', 'Sinh viên');
INSERT INTO NGHENGHIEP(MANGHENGHIEP, TENNGHENGHIEP) VALUES('NN009', 'Giáo viên');
INSERT INTO NGHENGHIEP(MANGHENGHIEP, TENNGHENGHIEP) VALUES('NN010', 'Giám đốc');
INSERT INTO NGHENGHIEP(MANGHENGHIEP, TENNGHENGHIEP) VALUES('NN011', 'Môi giới');
INSERT INTO NGHENGHIEP(MANGHENGHIEP, TENNGHENGHIEP) VALUES('NN012', 'Tiếp thị');


INSERT INTO QUANHE(MALOAIQUANHE, TENLOAIQUANHE) VALUES('QH001', 'Con');
INSERT INTO QUANHE(MALOAIQUANHE, TENLOAIQUANHE) VALUES('QH002', 'Vợ / Chồng');


INSERT INTO NGUYENNHAN(MANGUYENNHAN, TENNGUYENNHAN) VALUES('NNh001', 'Tai nạn');
INSERT INTO NGUYENNHAN(MANGUYENNHAN, TENNGUYENNHAN) VALUES('NNh002', 'Tự sát');
INSERT INTO NGUYENNHAN(MANGUYENNHAN, TENNGUYENNHAN) VALUES('NNh003', 'Ám sát');
INSERT INTO NGUYENNHAN(MANGUYENNHAN, TENNGUYENNHAN) VALUES('NNh004', 'Mưu sát');
INSERT INTO NGUYENNHAN(MANGUYENNHAN, TENNGUYENNHAN) VALUES('NNh005', 'Bệnh tật');
INSERT INTO NGUYENNHAN(MANGUYENNHAN, TENNGUYENNHAN) VALUES('NNh006', 'Hi sinh');


INSERT INTO DIADIEMMAITANG(MADIADIEMMAITANG, TENDIADIEMMAITANG) VALUES('DDMT001', 'TP.HCM');
INSERT INTO DIADIEMMAITANG(MADIADIEMMAITANG, TENDIADIEMMAITANG) VALUES('DDMT002', 'Hà Nội');
INSERT INTO DIADIEMMAITANG(MADIADIEMMAITANG, TENDIADIEMMAITANG) VALUES('DDMT003', 'Đà Nẵng');
INSERT INTO DIADIEMMAITANG(MADIADIEMMAITANG, TENDIADIEMMAITANG) VALUES('DDMT004', 'Quảng Ngãi');
INSERT INTO DIADIEMMAITANG(MADIADIEMMAITANG, TENDIADIEMMAITANG) VALUES('DDMT005', 'Quảng Nam');
INSERT INTO DIADIEMMAITANG(MADIADIEMMAITANG, TENDIADIEMMAITANG) VALUES('DDMT006', 'Huế');
INSERT INTO DIADIEMMAITANG(MADIADIEMMAITANG, TENDIADIEMMAITANG) VALUES('DDMT007', 'Bình Định');


INSERT INTO LOAITHANHTICH(MALOAITHANHTICH, TENLOAITHANHTICH) VALUES('LTT001', 'Thế giới');
INSERT INTO LOAITHANHTICH(MALOAITHANHTICH, TENLOAITHANHTICH) VALUES('LTT002', 'Châu lục');
INSERT INTO LOAITHANHTICH(MALOAITHANHTICH, TENLOAITHANHTICH) VALUES('LTT003', 'Quốc gia');
INSERT INTO LOAITHANHTICH(MALOAITHANHTICH, TENLOAITHANHTICH) VALUES('LTT004', 'Khu vực');
INSERT INTO LOAITHANHTICH(MALOAITHANHTICH, TENLOAITHANHTICH) VALUES('LTT005', 'Tỉnh');
INSERT INTO LOAITHANHTICH(MALOAITHANHTICH, TENLOAITHANHTICH) VALUES('LTT006', 'Huyện');
INSERT INTO LOAITHANHTICH(MALOAITHANHTICH, TENLOAITHANHTICH) VALUES('LTT007', 'Địa phương');

INSERT INTO THANHVIEN(MATHANHVIEN, HOVATEN, GIOITINH, NGAYGIOSINH, MAQUEQUAN, MANGHENGHIEP, DIACHI, MATHANHVIENCU, MALOAIQUANHE, NGAYPHATSINH) VALUES('TV001', 'Nguyễn Văn A', 1, '2003-05-24 10:30:00', 'QQ001', 'NN001', 'KTX khu A', null, null, '2023-06-25 10:30:00');
INSERT INTO THANHVIEN(MATHANHVIEN, HOVATEN, GIOITINH, NGAYGIOSINH, MAQUEQUAN, MANGHENGHIEP, DIACHI, MATHANHVIENCU, MALOAIQUANHE, NGAYPHATSINH) VALUES('TV002', 'Trần B', 1, '2004-06-24 10:30:00', 'QQ002', 'NN002', 'KTX khu A', 'TV001', 'QH002', '2023-06-25 10:30:00');
INSERT INTO THANHVIEN(MATHANHVIEN, HOVATEN, GIOITINH, NGAYGIOSINH, MAQUEQUAN, MANGHENGHIEP, DIACHI, MATHANHVIENCU, MALOAIQUANHE, NGAYPHATSINH) VALUES('TV003', 'Nguyễn Văn C', 1, '2012-06-24 10:30:00', 'QQ001', 'NN005', 'KTX khu B', 'TV001', 'QH001', '2023-06-25 10:30:00');
INSERT INTO THANHVIEN(MATHANHVIEN, HOVATEN, GIOITINH, NGAYGIOSINH, MAQUEQUAN, MANGHENGHIEP, DIACHI, MATHANHVIENCU, MALOAIQUANHE, NGAYPHATSINH) VALUES('TV004', 'Võ D', 1, '2013-06-24 10:30:00', 'QQ004', 'NN002', 'KTX khu A', 'TV003', 'QH002', '2023-06-25 10:30:00');
INSERT INTO THANHVIEN(MATHANHVIEN, HOVATEN, GIOITINH, NGAYGIOSINH, MAQUEQUAN, MANGHENGHIEP, DIACHI, MATHANHVIENCU, MALOAIQUANHE, NGAYPHATSINH) VALUES('TV005', 'Nguyễn Văn E', 1, '2017-06-24 10:30:00', 'QQ001', 'NN007', 'KTX khu B', 'TV004', 'QH001', '2023-06-25 10:30:00');
INSERT INTO THANHVIEN(MATHANHVIEN, HOVATEN, GIOITINH, NGAYGIOSINH, MAQUEQUAN, MANGHENGHIEP, DIACHI, MATHANHVIENCU, MALOAIQUANHE, NGAYPHATSINH) VALUES('TV006', 'Nguyễn Văn F', 1, '2019-06-24 10:30:00', 'QQ004', 'NN004', 'KTX khu B', 'TV001', 'QH001', '2023-06-25 10:30:00');
INSERT INTO THANHVIEN(MATHANHVIEN, HOVATEN, GIOITINH, NGAYGIOSINH, MAQUEQUAN, MANGHENGHIEP, DIACHI, MATHANHVIENCU, MALOAIQUANHE, NGAYPHATSINH) VALUES('TV007', 'Trần G', 1, '2020-06-24 10:30:00', 'QQ006', 'NN003', 'KTX khu A', 'TV006', 'QH002', '2023-06-25 10:30:00');

INSERT INTO KETTHUC(MAKETTHUC, HOVATEN, NGAYGIOMAT, MANGUYENNHAN, MADIADIEMMAITANG, MATHANHVIEN) VALUES('KT001', 'Nguyễn Văn A', '2053-05-24 10:30:00', 'NNh001', 'DDMT001', 'TV001');
INSERT INTO KETTHUC(MAKETTHUC, HOVATEN, NGAYGIOMAT, MANGUYENNHAN, MADIADIEMMAITANG, MATHANHVIEN) VALUES('KT002', 'Nguyễn Văn C', '2063-05-24 10:30:00', 'NNh002', 'DDMT001', 'TV003');
INSERT INTO KETTHUC(MAKETTHUC, HOVATEN, NGAYGIOMAT, MANGUYENNHAN, MADIADIEMMAITANG, MATHANHVIEN) VALUES('KT003', 'Nguyễn Văn E', '2073-05-24 10:30:00', 'NNh001', 'DDMT003', 'TV005');
INSERT INTO KETTHUC(MAKETTHUC, HOVATEN, NGAYGIOMAT, MANGUYENNHAN, MADIADIEMMAITANG, MATHANHVIEN) VALUES('KT004', 'Nguyễn Văn F', '2083-05-24 10:30:00', 'NNh003', 'DDMT004', 'TV006');

INSERT INTO THANHTICH(MATHANHTICH, HOVATEN, MALOAITHANHTICH, NGAYPHATSINH, MATHANHVIEN) VALUES('TT001', 'Nguyễn Văn A', 'LTT001', '2033-05-24 10:30:00', 'TV001');
INSERT INTO THANHTICH(MATHANHTICH, HOVATEN, MALOAITHANHTICH, NGAYPHATSINH, MATHANHVIEN) VALUES('TT002', 'Nguyễn Văn C', 'LTT001', '2043-05-24 10:30:00', 'TV003');
INSERT INTO THANHTICH(MATHANHTICH, HOVATEN, MALOAITHANHTICH, NGAYPHATSINH, MATHANHVIEN) VALUES('TT003', 'Nguyễn Văn E', 'LTT002', '2053-05-24 10:30:00', 'TV005');
INSERT INTO THANHTICH(MATHANHTICH, HOVATEN, MALOAITHANHTICH, NGAYPHATSINH, MATHANHVIEN) VALUES('TT004', 'Nguyễn Văn F', 'LTT004', '2063-05-24 10:30:00', 'TV006');